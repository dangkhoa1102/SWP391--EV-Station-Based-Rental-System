# ?? Admin Account Architecture

## Setup Flow

```
???????????????????????????????????????????????????????????????
?                    ADMIN ACCOUNT SETUP                      ?
???????????????????????????????????????????????????????????????

1. Code Changes
   ?? EVStationBasedRentalSystemDbContext.cs
   ?  ?? Added HashPassword() method
   ?  ?? Added Seed Data in OnModelCreating()
   ?? ? Complete

2. Create Migration
   ?? Command: dotnet ef migrations add AddHardcodedAdminUser
   ?? File: 20251028082216_AddHardcodedAdminUser.cs
   ?? ? Generated

3. Apply Migration
   ?? Command: dotnet ef database update
   ?? Table: Users
   ?? ? Applied

4. Result: Admin User in Database ?

???????????????????????????????????????????????????????????????
?                   DATABASE STRUCTURE                        ?
???????????????????????????????????????????????????????????????

Users Table
?? UserId: 00000000-0000-0000-0000-000000000001 ? FIXED ID
?? UserName: admin@ev.com
?? Email: admin@ev.com
?? FirstName: Admin
?? LastName: User
?? PasswordHash: jGl25bVBBBW96Qi9Te4V37Fnqchz/Eu4qB9vKrRIqRg=
?  ?? (SHA-256 hash of "admin")
?? UserRole: Admin
?? IsActive: true
?? IsVerified: true
?? CreatedAt: 2025-10-28 08:22:15.871996 UTC

???????????????????????????????????????????????????????????????
?                   AUTHENTICATION FLOW                       ?
???????????????????????????????????????????????????????????????

CLIENT                          SERVER                 DATABASE
  ?                              ?                         ?
  ?? POST /api/auth/Login ??????>?                         ?
  ?  (email: admin@ev.com)       ?                         ?
  ?  (password: admin)           ?                         ?
  ?                              ?? Hash password (SHA256)?
  ?                              ?                         ?
  ?                              ?? Query user ???????????>?
  ?                              ?                         ?
  ?                              ?<? Return user ??????????
  ?                              ?                         ?
  ?                              ?? Compare hashes        ?
  ?                              ? (Input vs PasswordHash)?
  ?                              ?                         ?
  ?                              ?? Create JWT Token      ?
  ?                              ?                         ?
  ?<? 200 OK + Token ?????????????                         ?
  ?  (+ RefreshToken)            ?                         ?
  ?  (+ User data)               ?                         ?
  ?                              ?                         ?
  ?? GET /api/auth/me ??????????>?                         ?
  ?  Authorization: Bearer...    ?                         ?
  ?                              ?? Verify JWT            ?
  ?                              ?                         ?
  ?<? 200 OK + User data ?????????                         ?
  ?                              ?                         ?

???????????????????????????????????????????????????????????????
?                   FILE STRUCTURE                            ?
???????????????????????????????????????????????????????????????

Monolithic/
?? Data/
?  ?? EVStationBasedRentalSystemDbContext.cs ? [MODIFIED]
?     ?? HashPassword() method
?     ?? Seed admin user
?? Migrations/
?  ?? 20251028082216_AddHardcodedAdminUser.cs ? [NEW]
?  ?? 20251028082216_AddHardcodedAdminUser.Designer.cs ? [NEW]
?? Models/
?  ?? User.cs (no changes needed)
?? Controllers/
?  ?? AuthController.cs (no changes needed)
?? Services/Implementation/
?  ?? AuthServiceImpl.cs (no changes needed)
?? Documentation/
?  ?? ADMIN_ACCOUNT.md ? [NEW]
?  ?? SETUP_ADMIN_ACCOUNT.md ? [NEW]
?  ?? README_ADMIN_SETUP.md ? [NEW]
?  ?? SETUP_COMPLETE_SUMMARY.md ? [NEW]
?  ?? QUICK_REFERENCE.md ? [NEW]
?  ?? ARCHITECTURE.md ? [THIS FILE]
?? Test Resources/
?  ?? test-admin-account.sh ? [NEW]
?  ?? test-admin-account.js ? [NEW]
?  ?? Admin-Account-Test.postman_collection.json ? [NEW]
?? Other files (unchanged)

???????????????????????????????????????????????????????????????
?                   PASSWORD HASHING                          ?
???????????????????????????????????????????????????????????????

Plain Text Password:
    "admin"
       ?
       ?? SHA-256 Hash Algorithm
       ?  (using System.Security.Cryptography.SHA256)
       ?
       ?? UTF-8 Encoding
       ?
       ?? Base64 Conversion
       ?
       ??> Hashed Password:
           "jGl25bVBBBW96Qi9Te4V37Fnqchz/Eu4qB9vKrRIqRg="

During Login:
    User Input: "admin"
       ?
       ??> SHA-256 + Base64
           ?
           ?? Compare with Database PasswordHash
           ?
           ?? Match ? ? Create JWT Token
           ?? No Match ? ? Return Error

???????????????????????????????????????????????????????????????
?                   JWT TOKEN FLOW                            ?
???????????????????????????????????????????????????????????????

Login Request
    ?
    ??> AuthController.Login()
        ?
        ??> AuthServiceImpl.LoginAsync()
            ?
            ?? Find user by email
            ?? Verify password
            ?? Generate JWT Token
            ?  (Claims: UserId, Email, Role)
            ?? Generate Refresh Token
            ?? Save Refresh Token to DB
                ?
                ??> Return LoginResponse
                    ?? AccessToken (JWT)
                    ?? RefreshToken
                    ?? User data

Protected Routes
    ?
    ?? Client sends: Authorization: Bearer <JWT_TOKEN>
    ?
    ??> AuthMiddleware validates JWT
        ?? Check signature
        ?? Check expiration
        ?? Extract claims
        ?? Allow/Deny request

???????????????????????????????????????????????????????????????
?                   KEY INFORMATION                           ?
???????????????????????????????????????????????????????????????

Admin Account:
?? Email: admin@ev.com
?? Password: admin
?? UserID: 00000000-0000-0000-0000-000000000001
?? Role: Admin
?? Status: Active & Verified ?

Code Changes:
?? Files Modified: 1
?  ?? EVStationBasedRentalSystemDbContext.cs
?? Lines Added: ~50 (seed data + hash method)
?? Breaking Changes: None ?

Database Changes:
?? Table Modified: Users
?? Row Added: 1 (admin user)
?? Migration: 20251028082216_AddHardcodedAdminUser
?? Status: Applied ?

Testing:
?? Via Swagger: ? Available
?? Via Postman: ? Collection provided
?? Via cURL: ? Test script provided
?? Via Bash: ? test-admin-account.sh
?? Via Node.js: ? test-admin-account.js

Documentation:
?? Overview: ADMIN_ACCOUNT.md
?? Technical: SETUP_ADMIN_ACCOUNT.md
?? Usage: README_ADMIN_SETUP.md
?? Summary: SETUP_COMPLETE_SUMMARY.md
?? Quick: QUICK_REFERENCE.md
?? Architecture: ARCHITECTURE.md (this file)

???????????????????????????????????????????????????????????????
?                   STATUS: ? COMPLETE                       ?
???????????????????????????????????????????????????????????????

• Code Implementation ?
• Database Migration ?
• Data Seeding ?
• Password Hashing ?
• Documentation ?
• Test Tools ?
• Ready for Testing ?
• Ready for Deployment ?

Last Updated: October 28, 2025
Ready for Production: YES ?

